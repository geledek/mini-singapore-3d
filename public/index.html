<!DOCTYPE html>
<html lang="en_SG" style="overscroll-behavior: none;">
<head>
	<!-- Google Analytics - ID loaded from environment -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=__GOOGLE_ANALYTICS_ID__"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());
		gtag('config', '__GOOGLE_ANALYTICS_ID__');
	</script>
	<meta charset="utf-8" />
	<link rel="stylesheet" href="mini-singapore-3d.min.css" />
	<title>Mini Singapore 3D</title>
	<meta name="description" content="A real-time 3D digital map of Singapore's public transport system. Based on Mini Tokyo 3D by Akihiko Kusanagi." />
	<meta name="viewport" content="user-scalable=no, minimum-scale=1.0, maximum-scale=1.0, width=device-width, height=device-height, initial-scale=1" />
	<meta property="og:title" content="Mini Singapore 3D" />
	<meta property="og:description" content="A real-time 3D digital map of Singapore's public transport system." />
	<meta property="og:locale" content="en_SG" />
	<link rel="canonical" href="__SHARE_URL__" />
	<meta property="og:url" content="__SHARE_URL__" />
	<meta property="og:site_name" content="Mini Singapore 3D" />
	<script src="mini-singapore-3d.min.js"></script>
</head>
<body style="width: 100%; height: 100%; margin: 0; padding: 0; position: absolute;">
	<div id="map" style="width: 100%; height: 100%;"></div>
	<script>
		const matchLang = location.search.match(/lang=(.*?)(?:&|$)/),
			matchSelection = location.search.match(/selection=(.*?)(?:&|$)/),
			matchGtfsUrl = location.search.match(/gtfsurl=(.*?)(?:&|$)/),
			matchVehiclePositionUrl = location.search.match(/gtfsvpurl=(.*?)(?:&|$)/),
			matchGtfsColor = location.search.match(/gtfscolor=(.*?)(?:&|$)/),
			matchHash = location.hash.match(/[^\d\.\-]*([\d\.\-]*)\/?([\d\.\-]*)\/?([\d\.\-]*)\/?([\d\.\-]*)\/?([\d\.\-]*)/),
			options = {
				container: 'map',
				// Mapbox access token - replaced at build time from environment
				accessToken: '__MAPBOX_ACCESS_TOKEN__'
			};

		if (matchLang) {
			options.lang = decodeURIComponent(matchLang[1]);
		}
		if (matchSelection) {
			options.selection = decodeURIComponent(matchSelection[1]);
		}
		if (matchHash[1]) {
			options.zoom = +matchHash[1];
		}
		if (matchHash[2] && matchHash[3]) {
			options.center = [+matchHash[3], +matchHash[2]];
		}
		if (matchHash[4]) {
			options.bearing = +matchHash[4];
		}
		if (matchHash[5]) {
			options.pitch = +matchHash[5];
		}
		if (matchGtfsUrl && matchGtfsColor) {
			options.dataSources = [{
				gtfsUrl: decodeURIComponent(matchGtfsUrl[1]),
				vehiclePositionUrl: matchVehiclePositionUrl ? decodeURIComponent(matchVehiclePositionUrl[1]) : undefined,
				color: `#${decodeURIComponent(matchGtfsColor[1])}`
			}];
		}

		const map = new mt3d.Map(options);

		// Expose map for debugging
		window.map = map;
	</script>
</body>
</html>
